
:spring_boot_version: 2.0.5.RELEASE
:spring-boot: https://github.com/spring-projects/spring-boot
:toc:
:icons: font
:source-highlighter: prettify

This projects helps demonstrate clean, flexible, and maitainable code by levraging the following language constructs for Java,SpringBoot applications  +
1. Usage of javax.validators +
2. Usage of @ExceptionsHandlers, and @ControllerAdvice +
3. Usage of Vertical Slicing for domain oriented design +
4. Usage of Single Table design using Relational database to improve application performance  +
5. Usage of Spring ApplicationEvents for Event driven components +

The description is provided in post here :

----
Java 11 or above
SpringBoot 
Embedded H2
Postgres
----


== What you'll build
You'll build a java springboot application that demonstrate the following:

1. Clean User Request Validation +
2. Decouple exception handling code form business logic +
3. Vertical slicing to develop decomposable monolith +
4. Single Table design approach +
5. Developing event driven components using ApplicationEvent +



Please check pom.xml for a list of all dependencies for other functionalities : 
Embedded H2, Postgres.



== Create Application
Here you create an `com.sdbawa.mmts.MoviesManagementAndTrackingApplication` class with the components:

`src/main/java/com/sdbawa/mmts/MoviesManagementAndTrackingApplication.java`
[source,java]
----
include::/main/java/com/sdbawa/mmts/MoviesManagementAndTrackingApplication.java[]
----

== Domain classes
The domain actor code can be found in  src/main/java/com/sdbawa/mmts/domain/*
The code for higher order domain actors are vertically sliced. exp. movie, actor.
One vertical slice contains the end to end code with an idea no two domains share code.

== Common code

Lookups and Events are shared concerns of the application. +

Lookups +
com.sdbawa.mmts.domain.statuslookup is a shared code for all the domains

Events+
ApplicationEvents can be found in com.sdbawa.mmts.domain.events.*

----
LoadStatusLookUpOnBootstrap.java is responsible to provide lookups from in-memory to
all modules in application. Also, this class is responsible to load all lookups in-memory
at startup.

----

== Web Layer Tests
`src.test.com.sdbawa.mmts.controller.*` provides web layer tests for the RESTful APIs

== Run the application
To run the application, using Maven, execute:

[subs="attributes"]
----
mvn package && java -jar target/graphql-java-server-0.1.0.jar
----

You should see some output like this:

........
2020-10-22 13:37:40.148  INFO 30880 --- [main] m.MoviesManagementAndTrackingApplication : Started MoviesManagementAndTrackingApplication in 6.297 seconds (JVM running for 8.511)
2020-10-22 13:37:40.988  INFO 30880 --- [-10.105.254.188] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2020-10-22 13:37:40.989  INFO 30880 --- [-10.105.254.188] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2020-10-22 13:37:41.002  INFO 30880 --- [-10.105.254.188] o.s.web.servlet.DispatcherServlet        : Completed initialization in 13 ms

This application is running at port 8080.
....
Check out data in-memory H2 database. http://localhost:8080/h2-console/

SELECT * FROM MOVIE
The result should show records.

This validated the application is working fine.

....

----
Spring ApplicationEvent

ApplicationEvents can be found in com.sdbawa.mmts.domain.events.*

select * from MOVIE_BUDGET_EVENTS - This should have NO records

Add Endorsement

http://localhost:8080/endorsement/add
Request: 
{
	"endorsementId" : 122,
	"amount" : 500000,
	"movieId" : 1
}


Response :
{
    "message": "success"
}

Update Actor status to confirm signining contract

http://localhost:8080/actor/status

Request:
{
	"actorId" : 1,
	"statusId": 6,
	"amount" : 100000,
	"movieId" : 1

}

Response:
{
    "message": "success"
}

 select * from MOVIE_BUDGET_EVENTS - There should be 2 records with each event
----


